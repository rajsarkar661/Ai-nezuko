<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Girlfriend - Maya</title>
    <style>
        body {
            margin: 0; background-color: #0f0c29; color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        #avatar-container {
            width: 250px; height: 250px; border-radius: 50%;
            border: 5px solid #ff4d6d; box-shadow: 0 0 30px #ff4d6d;
            margin-bottom: 30px; overflow: hidden; background: #000;
        }

        #avatar-container img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .talking { transform: scale(1.1); filter: brightness(1.2); }

        #display-box {
            width: 80%; max-width: 600px; text-align: center;
            background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .status { font-size: 14px; color: #00ffcc; margin-bottom: 10px; }
        .user-txt { font-size: 16px; color: #ccc; font-style: italic; }
        .ai-txt { font-size: 20px; font-weight: bold; color: #ffafbd; margin-top: 10px; }

        #start-btn {
            padding: 15px 40px; font-size: 20px; background: #ff4d6d;
            color: white; border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.4); z-index: 100;
        }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <button id="start-btn" onclick="initApp()">মায়ার সাথে কথা বলুন (Start)</button>
    </div>

    <div id="avatar-container">
        <!-- এখানে আপনার গার্লফ্রেন্ডের ছবি বা GIF দিন -->
        <img id="avatar" src="https://i.pinimg.com/originals/de/13/62/de1362e391b7e65123d13543666f363c.gif" alt="AI Avatar">
    </div>

    <div id="display-box">
        <div id="status" class="status">সিস্টেম বন্ধ</div>
        <p id="user-said" class="user-txt">আপনি যা বলবেন তা এখানে দেখাবে...</p>
        <p id="ai-reply" class="ai-text">মায়া যা বলবে তা এখানে দেখাবে...</p>
    </div>

    <script>
        const GEMINI_API_KEY = "AIzaSyCwIM6y0RgvdLivFUJilbnl92aPKFEwviU";
        const TTS_API_URL = "http://31.97.226.11:8000/tts?text=";

        const statusLabel = document.getElementById('status');
        const userLabel = document.getElementById('user-said');
        const aiLabel = document.getElementById('ai-reply');
        const avatar = document.getElementById('avatar');

        let recognition;
        let isProcessing = false;

        // ১. অ্যাপ শুরু করা
        function initApp() {
            document.getElementById('overlay').style.display = 'none';
            setupSpeechRecognition();
        }

        // ২. Speech to Text (আপনার কথাকে টেক্সট করা)
        function setupSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("আপনার ব্রাউজারে ভয়েস সাপোর্ট নেই। গুগল ক্রোম ব্যবহার করুন।");
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'bn-BD'; // বাংলা ভাষা
            recognition.continuous = false; // এক বাক্য শুনেই প্রসেস করবে

            recognition.onstart = () => {
                if (!isProcessing) {
                    statusLabel.innerText = "শুনছি... বলুন";
                    statusLabel.style.color = "#00ffcc";
                }
            };

            recognition.onresult = async (event) => {
                const transcript = event.results[0][0].transcript;
                userLabel.innerText = "আপনি: " + transcript;
                await processWithGemini(transcript);
            };

            recognition.onend = () => {
                if (!isProcessing) {
                    recognition.start(); // লুপে শোনা চালিয়ে যাবে
                }
            };

            recognition.start();
        }

        // ৩. Gemini Chat API (টেক্সট থেকে উত্তর তৈরি)
        async function processWithGemini(userMessage) {
            isProcessing = true;
            statusLabel.innerText = "মায়া ভাবছে...";
            statusLabel.style.color = "yellow";

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
            
            const payload = {
                contents: [{
                    parts: [{
                        text: `You are a virtual girlfriend named Maya. Answer in Bengali only. Be sweet and short. User said: ${userMessage}`
                    }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                aiLabel.innerText = "মায়া: " + aiResponse;

                // ৪. Voice API (উত্তরকে ভয়েস করা)
                await playVoice(aiResponse);

            } catch (error) {
                console.error("Gemini API Error:", error);
                statusLabel.innerText = "Error কানেকশন...";
                isProcessing = false;
                recognition.start();
            }
        }

        // ৫. Audio Play (ভয়েস শোনানো)
        function playVoice(text) {
            return new Promise((resolve) => {
                statusLabel.innerText = "কথা বলছি...";
                statusLabel.style.color = "#ff4d6d";
                avatar.classList.add('talking');

                // আপনার দেওয়া TTS API লিঙ্ক
                const audio = new Audio(TTS_API_URL + encodeURIComponent(text));
                
                audio.onended = () => {
                    avatar.classList.remove('talking');
                    isProcessing = false;
                    statusLabel.innerText = "শুনছি...";
                    recognition.start(); // কথা শেষ হলে আবার শোনা শুরু
                    resolve();
                };

                audio.onerror = () => {
                    console.log("Audio Error");
                    isProcessing = false;
                    recognition.start();
                    resolve();
                };

                audio.play();
            });
        }
    </script>
</body>
</html>
